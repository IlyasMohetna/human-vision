<div class="mb-2">
  <div
    (click)="toggleExpandState()"
    class="relative flex justify-between items-center h-10 px-6 bg-opacity-10 bg-black cursor-pointer hover:bg-opacity-20 hover:bg-black transition-all duration-200"
    [class.bg-opacity-20]="isExpanded"
  >
    <div
      class="absolute left-0 top-0 h-full w-1 transition-all duration-200 hover:w-1.5"
      [ngClass]="categoryColorClasses.marker"
    ></div>
    <div class="flex items-center">
      <img
        [src]="iconPath"
        [alt]="title.toLowerCase()"
        class="w-5 h-5 mr-2"
        draggable="false"
      />
      <span>{{ title }}</span>
    </div>
    <div class="flex items-center">
      <span
        class="text-xs px-2 py-0.5 rounded-full"
        [ngClass]="categoryColorClasses.badge"
      >
        {{ badgeText }}
      </span>
      <img
        src="assets/icons/down.svg"
        alt="toggle"
        class="w-4 h-4 ml-2 transition-transform duration-200"
        [class.transform]="isExpanded"
        [class.rotate-180]="isExpanded"
        draggable="false"
      />
    </div>
  </div>

  <div
    *ngIf="isExpanded"
    cdkDropList
    [id]="dropListId"
    [cdkDropListData]="annotations"
    [cdkDropListConnectedTo]="connectedDropLists"
    cdkDropListSortingDisabled="true"
    [cdkDropListEnterPredicate]="enterPredicate"
    [class]="
      priority === 'none' ? 'scroll-container-lg' : 'scroll-container-sm'
    "
    (cdkDropListDropped)="onItemDrop($event)"
    (cdkDropListEntered)="onContainerEnter()"
    (cdkDropListExited)="onContainerExit()"
  >
    <div
      *ngFor="let item of annotations"
      class="flex justify-between items-center p-2 mb-1 border-l hover:bg-black hover:bg-opacity-[0.13] cursor-move transition-colors duration-150"
      [ngClass]="categoryColorClasses.border"
      cdkDrag
      (mouseenter)="onItemHover(item.id)"
      (mouseleave)="onItemHoverEnd()"
      (cdkDragStarted)="onDragStart()"
      (cdkDragEnded)="onDragEnd()"
    >
      <div class="flex items-center">
        <input
          type="checkbox"
          [checked]="isItemActive(item.id)"
          (change)="onItemToggle(item.id)"
          class="mr-2"
        />
        <span>{{ item.label || "Unnamed" }}</span>
      </div>
      <span
        class="text-xs px-2 py-0.5 rounded-full"
        [ngClass]="categoryColorClasses.badge"
      >
        {{ badgeText }}
      </span>
    </div>

    <div
      *ngIf="
        annotations.length === 0 &&
        !isDragging &&
        !isAnyDragging &&
        !containerHasDrag
      "
      class="text-center py-4 text-gray-500 italic text-sm"
    >
      No annotations in this category
    </div>
  </div>
</div>
