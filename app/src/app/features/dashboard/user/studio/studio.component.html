<style></style>
<div class="flex h-screen">
  <!-- Left Sidebar with SideNavigationBar structure -->
  <aside class="SideNavigationBar left">
    <!-- CompanionBar for navigation buttons -->
    <div class="CompanionBar">
      <div
        *ngFor="let item of sidebarNavItems; let i = index"
        class="VerticalEditorButton"
        [class.active]="selectedSidebarItem === i"
        (click)="selectSidebarItem(i)"
        [attr.title]="item.label"
      >
        <!-- Only display the label in vertical orientation -->
        <span class="nav-text">{{ item.label }}</span>
      </div>
    </div>

    <!-- Content area for the selected navigation item -->
    <div class="NavigationBarContentWrapper">
      <div *ngIf="selectedSidebarItem === 0" class="ContentPanel">
        <h2 class="PanelTitle">Project</h2>
        <nav class="MenuItems">
          <a href="#" class="MenuItem">Dashboard</a>
          <a href="#" class="MenuItem">Settings</a>
          <a href="#" class="MenuItem">Export</a>
        </nav>
      </div>

      <div *ngIf="selectedSidebarItem === 1" class="ContentPanel">
        <h2 class="PanelTitle">Tools</h2>
        <nav class="MenuItems">
          <button (click)="toggleDrawMode()" class="MenuItem with-status">
            <span class="StatusIndicator" [class.active]="drawMode"></span>
            {{ drawMode ? "Disable Drawing" : "Enable Drawing" }}
          </button>

          <button (click)="toggleCrosshair()" class="MenuItem with-status">
            <span class="StatusIndicator" [class.active]="showCrosshair"></span>
            {{ showCrosshair ? "Hide Grid" : "Show Grid" }}
          </button>

          <button (click)="clearPolygons()" class="MenuItem">
            Clear Polygons
          </button>
        </nav>
      </div>

      <div *ngIf="selectedSidebarItem === 2" class="ContentPanel">
        <h2 class="PanelTitle">Zoom Controls</h2>
        <nav class="MenuItems">
          <button (click)="zoomIn()" class="MenuItem with-icon">
            <span class="MenuItemIcon">+</span>
            Zoom In
          </button>
          <button (click)="zoomOut()" class="MenuItem with-icon">
            <span class="MenuItemIcon">-</span>
            Zoom Out
          </button>
          <button (click)="resetZoom()" class="MenuItem with-icon">
            <span class="MenuItemIcon">â†º</span>
            Reset Zoom
          </button>
          <div class="ZoomStatus">
            <span class="ZoomLabel">Current:</span>
            <span class="ZoomValue">{{ zoomLevel.toFixed(1) }}x</span>
          </div>
        </nav>
      </div>

      <div *ngIf="selectedSidebarItem === 3" class="ContentPanel">
        <h2 class="PanelTitle">Annotations</h2>
        <div class="AnnotationsList">
          <div
            *ngFor="let poly of polygonDataList"
            class="AnnotationItem"
            [class.selected]="hoveredPolygonId === poly.id"
            (mouseenter)="setHoveredPolygon(poly.id)"
            (mouseleave)="clearHoveredPolygon()"
          >
            <input
              type="checkbox"
              [checked]="activePolygons[poly.id]"
              (change)="togglePolygon(poly.id)"
              class="AnnotationCheckbox"
            />
            <div class="AnnotationDetails">
              <div class="AnnotationName">{{ poly.label || "Unnamed" }}</div>
              <div
                class="AnnotationBadge"
                [ngClass]="{
                  high: poly.type === 'high',
                  medium: poly.type === 'medium',
                  low: poly.type === 'low'
                }"
              >
                {{ poly.type | uppercase }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="selectedSidebarItem === 4" class="ContentPanel">
        <h2 class="PanelTitle">Images</h2>
        <div class="ImagesList">
          <div
            class="VirtualList"
            style="position: relative; width: 300px; height: 909px"
          >
            <div
              style="
                position: relative;
                overflow: hidden;
                width: 100%;
                height: 100%;
              "
            >
              <div style="position: absolute; inset: 0; overflow: scroll">
                <div
                  class="VirtualListContent"
                  style="width: 300px; height: 150px"
                >
                  <div
                    class="ImagePreview selected"
                    style="
                      position: absolute;
                      left: 0;
                      top: 0;
                      width: 150px;
                      height: 150px;
                    "
                  >
                    <div
                      class="Foreground"
                      style="
                        width: 105px;
                        height: 52.5px;
                        left: 22.5px;
                        top: 48.75px;
                      "
                    >
                      <img
                        class="Image"
                        draggable="false"
                        src="/ico/yourImage.png"
                        alt=""
                        style="width: 105px; height: 52.5px; left: 0; top: 0"
                      />
                      <img
                        class="CheckBox"
                        draggable="false"
                        src="ico/ok.png"
                        alt="checkbox"
                      />
                    </div>
                    <div
                      class="Background"
                      style="
                        width: 105px;
                        height: 52.5px;
                        left: 22.5px;
                        top: 48.75px;
                      "
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <main
    class="flex-1 relative bg-[#4C4C4C] flex flex-col items-center justify-center"
  >
    <div class="w-full bg-[#383838] text-white py-2 px-4 shadow-md">
      <app-control-bar
        [zoomLevel]="zoomLevel"
        [isPanning]="spacePressed"
        (zoomIn)="zoomIn()"
        (zoomOut)="zoomOut()"
        (resetZoom)="resetZoom()"
        (toggleCrosshair)="toggleCrosshair()"
        [isCrosshair]="showCrosshair"
        (togglePanning)="togglePanning()"
        (maxZoom)="maxZoom()"
        [zoomLevel]="zoomLevel"
      >
      </app-control-bar>
    </div>

    <div class="flex-1 w-full relative flex items-center justify-center">
      <div
        class="relative w-full h-[90vh]"
        (mousedown)="onMouseDownContainer($event)"
        (mousemove)="onMouseMoveContainer($event)"
        (mouseup)="onMouseUpContainer($event)"
        (mouseenter)="handleMouseEnterContainer()"
        (mouseleave)="handleMouseLeaveContainer()"
        (mousemove)="updateCrosshairPosition($event)"
      >
        <div
          #imageContainer
          class="image-container"
          tabindex="0"
          (keydown)="handleKeyboardShortcuts($event)"
        >
          <div class="image-wrapper">
            <img
              #imageElement
              *ngIf="imageUrl"
              [src]="imageUrl"
              alt="Zoomable Image"
              class="zoomable-image"
              draggable="false"
              (load)="onImageLoad()"
            />
          </div>
        </div>

        <div
          class="crosshair-container"
          [style.display]="
            showCrosshair && isMouseInContainer ? 'block' : 'none'
          "
        >
          <div class="crosshair-h" [style.top.px]="crosshairY"></div>
          <div class="crosshair-v" [style.left.px]="crosshairX"></div>
        </div>

        <div
          class="coordinate-label"
          [style.display]="isMouseInContainer ? 'block' : 'none'"
          [style.left.px]="crosshairX + 10"
          [style.top.px]="crosshairY + 10"
        >
          {{
            showCoordinates
              ? displayedCoordinateX + ", " + displayedCoordinateY
              : "No Coordinates"
          }}
        </div>
      </div>

      <canvas
        #annotationCanvas
        class="absolute top-0 left-0 w-full h-full"
        [class.pointer-events-none]="!drawMode"
        style="z-index: 500"
        (mousedown)="startDrawing($event)"
        (mousemove)="drawPolygon($event)"
        (mouseup)="finishDrawing()"
      ></canvas>

      <div
        class="absolute bottom-2 right-2 bg-gray-900 text-white px-2 py-1 text-sm rounded"
        style="z-index: 2000"
      >
        {{
          showCoordinates
            ? "X: " + displayedCoordinateX + ", Y: " + displayedCoordinateY
            : "No Coordinates"
        }}

        | Zoom:
        {{ zoomLevel.toFixed(1) }}x
      </div>
    </div>
  </main>

  <!-- Right Sidebar -->
  <aside class="w-1/6 bg-[#282828] text-white p-4">
    <h2 class="text-lg font-bold mb-4">Tools</h2>
    <nav class="flex flex-col space-y-2">
      <button (click)="toggleDrawMode()" class="hover:bg-gray-600 p-2 rounded">
        {{ drawMode ? "Disable Drawing" : "Enable Drawing" }}
      </button>
      <button (click)="toggleCrosshair()" class="hover:bg-gray-600 p-2 rounded">
        {{ showCrosshair ? "Hide Grid" : "Show Grid" }}
      </button>
      <button (click)="clearPolygons()" class="hover:bg-gray-600 p-2 rounded">
        Clear Polygons
      </button>

      <div class="my-2 border-t border-gray-600"></div>

      <!-- Zoom Controls -->
      <div class="text-sm text-gray-400 mb-2">Zoom Controls:</div>
      <button (click)="zoomIn()" class="hover:bg-gray-600 p-2 rounded">
        Zoom In (+)
      </button>
      <button (click)="zoomOut()" class="hover:bg-gray-600 p-2 rounded">
        Zoom Out (-)
      </button>
      <button (click)="resetZoom()" class="hover:bg-gray-600 p-2 rounded">
        Reset Zoom (0)
      </button>

      <div class="my-2 border-t border-gray-600"></div>

      <!-- Annotations List -->
      <div class="text-sm text-gray-400 mb-2">Annotations:</div>
      <div class="max-h-64 overflow-y-auto">
        <div
          *ngFor="let poly of polygonDataList"
          class="flex items-center mb-2 p-2 rounded"
          [ngClass]="{
            'bg-gray-700': hoveredPolygonId === poly.id,
            'hover:bg-gray-700': hoveredPolygonId !== poly.id
          }"
          (mouseenter)="setHoveredPolygon(poly.id)"
          (mouseleave)="clearHoveredPolygon()"
        >
          <input
            type="checkbox"
            [checked]="activePolygons[poly.id]"
            (change)="togglePolygon(poly.id)"
            class="mr-2"
          />
          <div class="flex-1">
            <div class="flex items-center">
              <span class="font-medium">{{ poly.label || "Unnamed" }}</span>
              <span
                class="ml-auto px-2 py-1 text-xs rounded-full"
                [ngClass]="{
                  'bg-red-500': poly.type === 'high',
                  'bg-yellow-500': poly.type === 'medium',
                  'bg-green-500': poly.type === 'low'
                }"
              >
                {{ poly.type | uppercase }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </aside>
</div>
